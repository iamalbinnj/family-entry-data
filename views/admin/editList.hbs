<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Family Data</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-aFq/bzH65dt+w6FI2ooMVUpc+21e0SRygnTpmBvdBgSdnuTN7QbdgL+OapgHtvPp" crossorigin="anonymous">
</head>

<body>

    <section>
        <header class="row m-3">
            <h1>Update List</h1>
            <p><a href="/">Go to Home Page</a></p>
            <p><a href="/list">Go to List Page</a></p>
        </header>
        <div class="row m-3">
            <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                <button class="btn btn-info me-md-2" type="button">Download PDF</button>
            </div>
            <form action="/update/{{user._id}}" method="POST" class="row g-4" id="updateUser">
                <input type="hidden" name="_method" value="PUT">
                <div class="col-md-4">
                    <label for="inputState" class="form-label">Select Unit</label>
                    <select id="inputState selectUnit" name="unit" class="form-select border-success">
                        <option selected>{{user.unit}}</option>
                        <option>St. Mary's Unit</option>
                        <option>St. Antony's Unit</option>
                        <option>St. George Unit</option>
                        <option>Little Flower Unit</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <label for="inputText" class="form-label">House Name</label>
                    <input type="text" class="form-control border-success" placeholder="House Name"
                        value="{{user.houseN}}" name="houseN" id="houseName">
                </div>
                <div class="col-md-4">
                    <label for="inputText" class="form-label">Phone Number</label>
                    <input type="number" class="form-control border-success" placeholder="{{user.phoneN}}"
                        value="{{user.phoneN}}" name="phoneN" id="phoneNo">
                </div>
                <div class="col-md-4 m-3">
                    <button type="submit" class="btn btn-primary update-data">Update</button>
                </div>
            </form>
            <span class="border border-black mx-auto p-2" id="memberDetail">
                {{#each user.memberDetails}}
                    <form action="/updatemember/{{../user._id}}/{{this._id}}" method="POST" class="row g-4"
                        id="updateMember">
                        <input type="hidden" name="_method" value="PUT">
                        <div class="row g-4" id="memberDetails-{{@index}}">
                            <div class="col-md-4 p-3">
                                <label for="inputText" class="form-label">Name</label>
                                <input type="text" class="form-control border-success" placeholder="Name"
                                    value="{{this.name}}" name="name" id="name">
                            </div>
                            <div class="col-md-4 p-3">
                                <label for="inputText" class="form-label">Relation</label>
                                <input type="text" class="form-control border-success" placeholder="Relation"
                                    value="{{this.relation}}" name="relation" id="relation">
                            </div>
                            <div class="col-md-1 p-3">
                                <label for="inputText" class="form-label">Age</label>
                                <input type="number" class="form-control border-success" placeholder="Age"
                                    value="{{this.age}}" name="age" id="age" style="width: 70px;">
                            </div>
                            <div class="row">
                                <div class="col-md-3 p-3">
                                    <label for="inputText" class="form-label">Date of Birth</label>
                                    <label for="inputText" class="form-label">{{this.dob}}</label>
                                    <input type="date" class="form-control border-success" name="dob" id="dob"
                                        style="width: 150px;">
                                </div>
                                <div class="col-md-3 p-3">
                                    <label for="inputText" class="form-label">Baptism Date</label>
                                    <label for="inputText" class="form-label">{{this.bDate}}</label>
                                    <input type="date" class="form-control border-success" name="bDate"
                                        value="{{this.bDate}}" id="bDate" style="width: 150px;">
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-2 p-3">
                                    <label for="inputText" class="form-label">Abroad or Not</label>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input border-success" type="radio" name="abroad"
                                            id="abroad" value="yes" {{#if abroad}}checked{{/if}}>
                                        <label class="form-check-label" for="inlineRadio1">Yes</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input border-success" type="radio" name="abroad"
                                            id="abroad" value="no" {{#unless abroad}}checked{{/unless}}>
                                        <label class="form-check-label" for="inlineRadio2">No</label>
                                    </div>
                                </div>
                                <div class="col-md-4 p-3" id="placename" {{#unless abroad}}style="display:none"
                                    {{/unless}}>
                                    <label for="inputText" class="form-label">Place Name</label>
                                    <input type="text" class="form-control border-success" placeholder="Place Name"
                                        name="placeName" id="placeName" value="{{this.placeName}}">
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-2 p-3">
                                    <label for="inputText" class="form-label">Married or Not</label>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input border-success" type="radio" name="married"
                                            id="marryyes" value="yes" {{#if married}}checked{{/if}}>
                                        <label class="form-check-label" for="inlineRadio1">Yes</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input border-success" type="radio" name="married"
                                            id="marryno" value="no" {{#unless married}}checked{{/unless}}>
                                        <label class="form-check-label" for="inlineRadio2">No</label>
                                    </div>
                                </div>
                                <div class="col-md-3 p-3" {{#unless married}}style="display:none" {{/unless}}>
                                    <label for="inputText" class="form-label">Date of Marrage</label>
                                    <label for="inputText" class="form-label">{{this.dom}}</label>
                                    <input type="date" class="form-control border-success" name="dom" id="dom"
                                        style="width: 150px;">
                                </div>
                                <div class="col-md-4 p-3" {{#unless married}}style="display:none" {{/unless}}>
                                    <label for="inputText" class="form-label">Partner Name</label>
                                    <input type="text" class="form-control border-success" placeholder="Partner Name"
                                        name="partnerName" id="partnerName" value="{{this.partnerName}}">
                                </div>
                            </div>
                        </div>
                        <input type="submit" value="Update Member" class="btn btn-primary mt-3 m-3 update-mem"
                            id="update-member" style="width: 50%;">
                        <button class="btn btn-danger mt-3 m-3 delete-member" data-id="{{../user._id}}"
                            data-memberid="{{this._id}}" style="width: 50%;">Delete Member</button>
                        <hr class="border border-success border-2 opacity-50">
                    </form>
                {{/each}}
            </span>
            <div class=" row m-3">
                <button type="button" class="btn btn-danger delete-data" data-id="{{user._id}}"
                    style="width: 50%;">Delete</button>
            </div>
        </div>
        <script>
            //Delete Member
            document.querySelectorAll('.delete-member').forEach(button => {
                button.addEventListener('click', event => {
                    const memberId = event.target.getAttribute('data-memberid');
                    const userId = event.target.getAttribute('data-id');
                    const message = `Are you sure you want to delete member?`;

                    if (confirm(message)) {
                        fetch(`/${userId}/${memberId}`, {
                            method: 'DELETE'
                        })
                            .then(response => {
                                if (response.ok) {
                                    location.reload();
                                } else {
                                    throw new Error('Failed to delete member');
                                }
                            })
                            .catch(error => alert(error.message));
                    }
                });
            });

            // Delete Data
            document.querySelectorAll('.delete-data').forEach(button => {
                button.addEventListener('click', event => {
                    const userId = event.target.getAttribute('data-id');
                    const message = `Are you sure you want to delete family?`;

                    if (confirm(message)) {
                        fetch(`/${userId}`, {
                            method: 'DELETE'
                        })
                            .then(response => {
                                if (response.ok) {
                                    window.location.href = "/list";
                                } else {
                                    throw new Error('Failed to delete member');
                                }
                            })
                            .catch(error => alert(error.message));
                    }
                });
            });
        </script>
    </section>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-qKXV1j0HvMUeCBQ+QVp7JcfGl760yU08IQ+GpUo5hlbpg51QRiuqHAJz8+BrxE/N"
        crossorigin="anonymous"></script>
    {{!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.4/jquery.min.js" integrity="sha512-pumBsjNRGGqkPzKHndZMaAG+bir374sORyzM3uulLV14lN5LyykqNk8eEeUlUkB3U0M4FApyaHraT65ihJhDpQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script> --}}
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</body>

</html>